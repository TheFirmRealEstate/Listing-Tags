<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edit Vendor Contacts</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4f8;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }

    .nav-button {
      display: block;
      width: max-content;
      margin: 0 auto 20px auto;
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      text-align: center;
      text-decoration: none;
    }

    form, .vendor-list, .password-section {
      max-width: 600px;
      margin: 0 auto 30px auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .vendor-card {
      background-color: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .vendor-card.editing {
      border: 2px solid #28a745;
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      width: 100%;
    }
  </style>
</head>
<body>
  <a class="nav-button" href="Important-numbers.html">‚Üê Back to Vendor List</a>

  <h1>Edit Vendor Contacts</h1>
  <form id="vendorForm">
    <h3>Add New Vendor</h3>
    <label>Category</label>
    <select id="category" required>
      <option>Appliance Repair</option>
      <option>Carpentry</option>
      <option>Cleaning</option>
      <option>Driveway/Asphalt</option>
      <option>Electrician</option>
      <option>Fencing</option>
      <option>Flooring</option>
      <option>Garage Door</option>
      <option>Gutter Cleaning</option>
      <option>Handyman</option>
      <option>Heating & Cooling (HVAC)</option>
      <option>Home Security</option>
      <option>Insulation</option>
      <option>Irrigation</option>
      <option>Landscaping</option>
      <option>Locksmith</option>
      <option>Masonry</option>
      <option>Painting</option>
      <option>Pest Control</option>
      <option>Plumber</option>
      <option>Pool Maintenance</option>
      <option>Remodeling</option>
      <option>Roofing</option>
      <option>Septic</option>
      <option>Siding</option>
      <option>Snow Removal</option>
      <option>Solar</option>
      <option>Surveyor</option>
      <option>Tile Work</option>
      <option>Tree Services</option>
      <option>Well/Water Systems</option>
      <option>Window Cleaning</option>
      <option>Windows & Doors</option>
      <option>Other</option>
    </select>

    <label>Name</label>
    <input id="name" required />

    <label>Phone</label>
    <input id="phone" />

    <label>Email</label>
    <input id="email" />

    <label>Website</label>
    <input id="website" />

    <button type="submit">Add Vendor</button>
  </form>

  <div class="vendor-list" id="vendorList"></div>

  <div class="password-section">
    <h3>Change Password</h3>
    <label>Old Password</label>
    <input id="oldPassword" type="password" />
    <button type="button" onclick="togglePasswordVisibility('oldPassword')">üëÅÔ∏è</button><br>
    <label>New Password</label>
    <input id="newPassword" type="password" />
    <button type="button" onclick="togglePasswordVisibility('newPassword')">üëÅÔ∏è</button><br>
    <button onclick="changePassword()">Change Password</button>
  </div>

  <a class="nav-button" href="Important-numbers.html">‚Üê Back to Vendor List</a>

  <div class="modal" id="editModal">
    <div class="modal-content" style="min-width: 420px">
      <h3>Edit Vendor</h3>
      <label>Category</label>
      <select id="editCategory">
        <option>Appliance Repair</option>
        <option>Carpentry</option>
        <option>Cleaning</option>
        <option>Driveway/Asphalt</option>
        <option>Electrician</option>
        <option>Fencing</option>
        <option>Flooring</option>
        <option>Garage Door</option>
        <option>Gutter Cleaning</option>
        <option>Handyman</option>
        <option>Heating & Cooling (HVAC)</option>
        <option>Home Security</option>
        <option>Insulation</option>
        <option>Irrigation</option>
        <option>Landscaping</option>
        <option>Locksmith</option>
        <option>Masonry</option>
        <option>Painting</option>
        <option>Pest Control</option>
        <option>Plumber</option>
        <option>Pool Maintenance</option>
        <option>Remodeling</option>
        <option>Roofing</option>
        <option>Septic</option>
        <option>Siding</option>
        <option>Snow Removal</option>
        <option>Solar</option>
        <option>Surveyor</option>
        <option>Tile Work</option>
        <option>Tree Services</option>
        <option>Well/Water Systems</option>
        <option>Window Cleaning</option>
        <option>Windows & Doors</option>
        <option>Other</option>
      </select>
      <label>Name</label>
      <input id="editName" />
      <label>Phone</label>
      <input id="editPhone" />
      <label>Email</label>
      <input id="editEmail" />
      <label>Website</label>
      <input id="editWebsite" />
      <button onclick="saveEdit()">Save</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';
    import { getAuth, updatePassword, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBzI_qVMcNVtpc4vTycLwoj35G41-wrlHk",
      authDomain: "listing-tags.firebaseapp.com",
      databaseURL: "https://listing-tags-default-rtdb.firebaseio.com",
      projectId: "listing-tags",
      storageBucket: "listing-tags.firebasestorage.app",
      messagingSenderId: "694142664765",
      appId: "1:694142664765:web:06e635c9703ab749a4aa54",
      measurementId: "G-6F73KCXH4C"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function togglePasswordVisibility(id) {
      const input = document.getElementById(id);
      input.type = input.type === 'password' ? 'text' : 'password';
    }
    const vendorRef = ref(db, 'vendors');
    const auth = getAuth(app);

    signInAnonymously(auth);

    const vendorForm = document.getElementById('vendorForm');
    const vendorList = document.getElementById('vendorList');

    vendorForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const vendor = {
        category: category.value,
        name: name.value,
        phone: phone.value,
        email: email.value,
        website: website.value
      };
      push(vendorRef, vendor);
      vendorForm.reset();
    });

    function loadVendors() {
      onValue(vendorRef, (snapshot) => {
        vendorList.innerHTML = '';
        snapshot.forEach(child => {
          const key = child.key;
          const data = child.val();

          const div = document.createElement('div');
          div.className = 'vendor-card';
          div.innerHTML = `
            <strong>${data.category}</strong><br>
            ${data.name}<br>
            üìû ${data.phone || 'N/A'}<br>
            ‚úâÔ∏è ${data.email || 'N/A'}<br>
            üåê ${data.website || 'N/A'}
            <div class="button-row">
              <button onclick="openEditModal('${key}', '${data.category}', '${data.name}', '${data.phone}', '${data.email}', '${data.website}')">Edit</button>
              <button onclick="confirmDelete('${key}')">Delete</button>
            </div>
          `;
          vendorList.appendChild(div);
        });
      });
    }
    loadVendors();

    window.confirmDelete = function(key) {
      if (confirm("Are you sure you want to delete this vendor?")) {
        remove(ref(db, 'vendors/' + key));
      }
    }

    let currentEditKey = null;

    window.openEditModal = function(key, category, name, phone, email, website) {
      currentEditKey = key;
      document.getElementById('editCategory').value = category;
      document.getElementById('editName').value = name;
      document.getElementById('editPhone').value = phone;
      document.getElementById('editEmail').value = email;
      document.getElementById('editWebsite').value = website;
      document.getElementById('editModal').style.display = 'flex';
    }

    window.closeModal = function() {
      currentEditKey = null;
      document.getElementById('editModal').style.display = 'none';
    }

    window.saveEdit = function() {
      const edited = {
        category: document.getElementById('editCategory').value,
        name: document.getElementById('editName').value,
        phone: document.getElementById('editPhone').value,
        email: document.getElementById('editEmail').value,
        website: document.getElementById('editWebsite').value
      };
      if (currentEditKey) {
        update(ref(db, 'vendors/' + currentEditKey), edited);
        closeModal();
      }
    }

    window.changePassword = function() {
      const user = auth.currentUser;
      const newPassword = document.getElementById('newPassword').value;
      if (user) {
        updatePassword(user, newPassword).then(() => {
          alert("Password updated successfully.");
        }).catch((error) => {
          alert("Error updating password: " + error.message);
        });
      }
    }
  </script>
</body>
</html>
